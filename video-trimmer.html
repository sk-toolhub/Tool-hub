<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Video Trimmer Tool</title>

  <!-- FFmpeg.wasm CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.4/dist/ffmpeg.min.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f4f8ff;
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .card {
      width: 100%;
      max-width: 700px;
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(10, 35, 100, 0.08);
    }
    h2 { text-align: center; color: #0066ff; margin-bottom: 14px; }
    label { font-weight: 600; margin-top: 10px; display: block; color: #333; }
    input[type=file], input[type=number], button {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #e6efff;
      margin-top: 8px;
      box-sizing: border-box;
      font-size: 14px;
    }
    .row { display: flex; gap: 10px; margin-top: 10px; }
    .col { flex: 1; }
    button.primary {
      background: #0066ff;
      color: #fff;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }
    button.ghost {
      background: transparent;
      border: 1px solid #e6f0ff;
      color: #0066ff;
      cursor: pointer;
      font-weight: 600;
    }
    .progress { height: 10px; background: #eef5ff; border-radius: 8px; overflow: hidden; margin-top: 12px; }
    .progress i { display: block; height: 100%; background: #0066ff; width: 0%; transition: width .3s ease; }
    .note { font-size: 13px; color: #555; margin-top: 8px; }
    video {
      width: 100%;
      border-radius: 10px;
      margin-top: 14px;
      background: #f9fbff;
      border: 1px solid #eef6ff;
    }
    .controls { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
  </style>
</head>
<body>
  <div class="card">
    <h2>✂️ Video Trimmer Tool</h2>

    <label>Select Video</label>
    <input id="videoFile" type="file" accept="video/*" />

    <video id="preview" controls style="display:none;"></video>

    <div class="row">
      <div class="col">
        <label>Start Time (seconds)</label>
        <input id="start" type="number" min="0" placeholder="e.g. 5" />
      </div>
      <div class="col">
        <label>End Time (seconds)</label>
        <input id="end" type="number" min="1" placeholder="e.g. 12" />
      </div>
    </div>

    <div class="controls">
      <button id="trimBtn" class="primary">Trim Video</button>
      <button id="resetBtn" class="ghost">Reset</button>
    </div>

    <div class="progress"><i id="progressBar"></i></div>
    <div id="status" class="note"></div>

    <div id="outputSection" style="display:none; margin-top:16px;">
      <label>Trimmed Video:</label>
      <video id="outputVideo" controls></video>
      <a id="downloadLink" href="#" download style="display:block; color:#0066ff; font-weight:600; margin-top:10px;">⬇ Download Trimmed Video</a>
    </div>
  </div>

  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: false });

    const videoInput = document.getElementById("videoFile");
    const preview = document.getElementById("preview");
    const startInput = document.getElementById("start");
    const endInput = document.getElementById("end");
    const trimBtn = document.getElementById("trimBtn");
    const resetBtn = document.getElementById("resetBtn");
    const progressBar = document.getElementById("progressBar");
    const status = document.getElementById("status");
    const outputSection = document.getElementById("outputSection");
    const outputVideo = document.getElementById("outputVideo");
    const downloadLink = document.getElementById("downloadLink");

    let selectedFile = null;
    let trimmedUrl = null;

    videoInput.addEventListener("change", () => {
      const file = videoInput.files[0];
      if (!file) return;
      selectedFile = file;
      preview.src = URL.createObjectURL(file);
      preview.style.display = "block";
      outputSection.style.display = "none";
      status.textContent = `${file.name} — ${(file.size / 1024 / 1024).toFixed(2)} MB`;
    });

    const setProgress = p => progressBar.style.width = `${p}%`;
    const setStatus = t => status.textContent = t;

    trimBtn.addEventListener("click", async () => {
      if (!selectedFile) return alert("Please upload a video first!");
      const start = parseFloat(startInput.value);
      const end = parseFloat(endInput.value);
      if (isNaN(start) || isNaN(end) || end <= start)
        return alert("Please enter valid start and end times.");

      trimBtn.disabled = true;
      resetBtn.disabled = true;
      setProgress(0);
      setStatus("Loading FFmpeg core...");

      if (!ffmpeg.isLoaded()) await ffmpeg.load();

      const inputName = "input." + selectedFile.name.split(".").pop();
      const outputName = "output.mp4";
      ffmpeg.FS("writeFile", inputName, await fetchFile(selectedFile));

      setStatus("Trimming video...");
      setProgress(50);

      try {
        await ffmpeg.run(
          "-i", inputName,
          "-ss", String(start),
          "-to", String(end),
          "-c", "copy",
          "-y", outputName
        );

        const data = ffmpeg.FS("readFile", outputName);
        const blob = new Blob([data.buffer], { type: "video/mp4" });
        trimmedUrl = URL.createObjectURL(blob);
        outputVideo.src = trimmedUrl;
        outputSection.style.display = "block";
        downloadLink.href = trimmedUrl;
        setProgress(100);
        setStatus("✅ Video trimmed successfully!");
      } catch (err) {
        console.error(err);
        setStatus("❌ Error trimming video!");
      } finally {
        ffmpeg.FS("unlink", inputName);
        ffmpeg.FS("unlink", outputName);
        trimBtn.disabled = false;
        resetBtn.disabled = false;
      }
    });

    resetBtn.addEventListener("click", () => {
      if (preview.src) URL.revokeObjectURL(preview.src);
      if (trimmedUrl) URL.revokeObjectURL(trimmedUrl);
      videoInput.value = "";
      preview.style.display = "none";
      outputSection.style.display = "none";
      setProgress(0);
      setStatus("");
      startInput.value = "";
      endInput.value = "";
    });
  </script>
</body>
</html>
